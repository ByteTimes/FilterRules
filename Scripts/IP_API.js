// geo_location_checker=http://ip-api.com/json/, https://raw.githubusercontent.com/SavileLee/FilterRules/Rules/Scripts/IP_API.js

if ($response.statusCode != 200) {
    $done(null);
}

var default_regionName = "Oops!!!";
var default_city = "Oh No!!!";
var default_org = "Cross Utility Ltd";

function RegionName_Check(para) {
    if (para) {
        return para;
    } else {
        return default_regionName;
    }
}

function City_Check(para) {
    if (para) {
        return para;
    } else {
        return default_city;
    }
}

function Org_Check(para) {
    if (para) {
        return para;
    } else {
        return default_org;
    }
}

function Area_Check(para) {
  if(para=="ä¸­è¯æ°‘åœ‹"){
  return "å°æ¹¾"
  } else
  {
  return para
  }
}

var flags = new Map([  [ "å—é" , "ğŸ‡¦ğŸ‡«" ] , [ "å®‰å‰æ‹‰" , "ğŸ‡¦ğŸ‡®" ] , [ "é˜¿å°”å·´å°¼äºš" , "ğŸ‡¦ğŸ‡±" ] , [ "äºšç¾å°¼äºš" , "ğŸ‡¦ğŸ‡²" ] , [ "å—ææ´²" , "ğŸ‡¦ğŸ‡¶" ] , [ "é˜¿æ ¹å»·" , "ğŸ‡¦ğŸ‡·" ] , [ "ç¾å±è¨å°¼äºš" , "ğŸ‡¦ğŸ‡¸" ] , [ "å¥¥åœ°åˆ©" , "ğŸ‡¦ğŸ‡¹" ] , [ "æ¾³å¤§åˆ©äºš" , "ğŸ‡¦ğŸ‡º" ] , [ "é˜¿é²å·´" , "ğŸ‡¦ğŸ‡¼" ] , [ "å¥¥å…°" , "ğŸ‡¦ğŸ‡½" ] , [ "é˜¿å¡æ‹œç–†" , "ğŸ‡¦ğŸ‡¿" ] , [ "å·´å·´å¤šæ–¯" , "ğŸ‡§ğŸ‡§" ] , [ "å­ŸåŠ æ‹‰" , "ğŸ‡§ğŸ‡©" ] , [ "æ¯”åˆ©æ—¶" , "ğŸ‡§ğŸ‡ª" ] , [ "å¸ƒåŸºçº³æ³•ç´¢" , "ğŸ‡§ğŸ‡«" ] , [ "ä¿åŠ åˆ©äºš" , "ğŸ‡§ğŸ‡¬" ] , [ "å·´æ—" , "ğŸ‡§ğŸ‡­" ] , [ "å¸ƒéš†è¿ª" , "ğŸ‡§ğŸ‡®" ] , [ "è´å®" , "ğŸ‡§ğŸ‡¯" ] , [ "ç™¾æ…•å¤§" , "ğŸ‡§ğŸ‡²" ] , [ "æ–‡è±" , "ğŸ‡§ğŸ‡³" ] , [ "ç»åˆ©ç»´äºš" , "ğŸ‡§ğŸ‡´" ] , [ "å·´è¥¿" , "ğŸ‡§ğŸ‡·" ] , [ "å·´å“ˆé©¬" , "ğŸ‡§ğŸ‡¸" ] , [ "ä¸ä¸¹" , "ğŸ‡§ğŸ‡¹" ] , [ "æŒªå¨" , "ğŸ‡§ğŸ‡»" ] , [ "åšèŒ¨ç“¦çº³" , "ğŸ‡§ğŸ‡¼" ] , [ "ç™½ä¿„ç½—æ–¯" , "ğŸ‡§ğŸ‡¾" ] , [ "ä¼¯åˆ©å…¹" , "ğŸ‡§ğŸ‡¿" ] , [ "åŠ æ‹¿å¤§" , "ğŸ‡¨ğŸ‡¦" ] , [ "ä¸­éå…±å’Œå›½" , "ğŸ‡¨ğŸ‡«" ] , [ "ç‘å£«" , "ğŸ‡¨ğŸ‡­" ] , [ "åº“å…‹ç¾¤å²›" , "ğŸ‡¨ğŸ‡°" ] , [ "æ™ºåˆ©" , "ğŸ‡¨ğŸ‡±" ] , [ "å–€éº¦éš†" , "ğŸ‡¨ğŸ‡²" ] , [ "ä¸­å›½" , "ğŸ‡¨ğŸ‡³" ] , [ "å“¥ä¼¦æ¯”äºš" , "ğŸ‡¨ğŸ‡´" ] , [ "CP" , "ğŸ‡¨ğŸ‡µ" ] , [ "å“¥æ–¯è¾¾é»åŠ " , "ğŸ‡¨ğŸ‡·" ] , [ "å¤å·´" , "ğŸ‡¨ğŸ‡º" ] , [ "ä½›å¾—è§’" , "ğŸ‡¨ğŸ‡»" ] , [ "åº“æ‹‰ç´¢" , "ğŸ‡¨ğŸ‡¼" ] , [ "åœ£è¯å²›" , "ğŸ‡¨ğŸ‡½" ] , [ "å¡æµ¦è·¯æ–¯" , "ğŸ‡¨ğŸ‡¾" ] , [ "æ·å…‹" , "ğŸ‡¨ğŸ‡¿" ] , [ "å¾·å›½" , "ğŸ‡©ğŸ‡ª" ] , [ "DG" , "ğŸ‡©ğŸ‡¬" ] , [ "å‰å¸ƒæ" , "ğŸ‡©ğŸ‡¯" ] , [ "ä¸¹éº¦" , "ğŸ‡©ğŸ‡°" ] , [ "å¤šç±³å°¼å…‹" , "ğŸ‡©ğŸ‡²" ] , [ "å¤šç±³å°¼åŠ " , "ğŸ‡©ğŸ‡´" ] , [ "é˜¿å°”åŠåˆ©äºš" , "ğŸ‡©ğŸ‡¿" ] , [ "è¥¿ç­ç‰™" , "ğŸ‡ªğŸ‡¦" ] , [ "å„ç“œå¤šå°”" , "ğŸ‡ªğŸ‡¨" ] , [ "çˆ±æ²™å°¼äºš" , "ğŸ‡ªğŸ‡ª" ] , [ "åŸƒåŠ" , "ğŸ‡ªğŸ‡¬" ] , [ "è¥¿æ’’å“ˆæ‹‰" , "ğŸ‡ªğŸ‡­" ] , [ "å„ç«‹ç‰¹é‡Œäºš" , "ğŸ‡ªğŸ‡·" ] , [ "è¥¿ç­ç‰™" , "ğŸ‡ªğŸ‡¸" ] , [ "åŸƒå¡ä¿„æ¯”äºš" , "ğŸ‡ªğŸ‡¹" ] , [ "æ¬§ç›Ÿ" , "ğŸ‡ªğŸ‡º" ] , [ "èŠ¬å…°" , "ğŸ‡«ğŸ‡®" ] , [ "æ–æµ" , "ğŸ‡«ğŸ‡¯" ] , [ "ç¦å…‹å…°ç¾¤å²›" , "ğŸ‡«ğŸ‡°" ] , [ "å¯†å…‹ç½—å°¼è¥¿äºšè”é‚¦" , "ğŸ‡«ğŸ‡²" ] , [ "æ³•ç½—ç¾¤å²›" , "ğŸ‡«ğŸ‡´" ] , [ "æ³•å›½" , "ğŸ‡«ğŸ‡·" ] , [ "åŠ è“¬" , "ğŸ‡¬ğŸ‡¦" ] , [ "è‹±å›½" , "ğŸ‡¬ğŸ‡§" ] , [ "é¦™æ¸¯" , "ğŸ‡­ğŸ‡°" ] ,["åŒˆç‰™åˆ©","ğŸ‡­ğŸ‡º"], [ "å°åº¦å°¼è¥¿äºš" , "ğŸ‡®ğŸ‡©" ] , [ "çˆ±å°”å…°" , "ğŸ‡®ğŸ‡ª" ] , [ "ä»¥è‰²åˆ—" , "ğŸ‡®ğŸ‡±" ] , [ "æ›¼å²›" , "ğŸ‡®ğŸ‡²" ] , [ "å°åº¦" , "ğŸ‡®ğŸ‡³" ] , [ "å†°å²›" , "ğŸ‡®ğŸ‡¸" ] , [ "æ„å¤§åˆ©" , "ğŸ‡®ğŸ‡¹" ] , [ "æ—¥æœ¬" , "ğŸ‡¯ğŸ‡µ" ] , [ "éŸ©å›½" , "ğŸ‡°ğŸ‡·" ] , [ "å¢æ£®å ¡" , "ğŸ‡±ğŸ‡º" ] , [ "æ¾³é—¨" , "ğŸ‡²ğŸ‡´" ] , [ "å¢¨è¥¿å“¥" , "ğŸ‡²ğŸ‡½" ] , [ "é©¬æ¥è¥¿äºš" , "ğŸ‡²ğŸ‡¾" ] , [ "è·å…°" , "ğŸ‡³ğŸ‡±" ] , [ "è²å¾‹å®¾" , "ğŸ‡µğŸ‡­" ] , [ "ç½—é©¬å°¼äºš" , "ğŸ‡·ğŸ‡´" ] , [ "å¡å°”ç»´äºš" , "ğŸ‡·ğŸ‡¸" ] , [ "ä¿„ç½—æ–¯" , "ğŸ‡·ğŸ‡º" ] , [ "å¢æ—ºè¾¾" , "ğŸ‡·ğŸ‡¼" ] , [ "æ²™ç‰¹é˜¿æ‹‰ä¼¯" , "ğŸ‡¸ğŸ‡¦" ] , [ "æ‰€ç½—é—¨ç¾¤å²›" , "ğŸ‡¸ğŸ‡§" ] , [ "å¡èˆŒå°”" , "ğŸ‡¸ğŸ‡¨" ] , [ "è‹ä¸¹" , "ğŸ‡¸ğŸ‡©" ] , [ "ç‘å…¸" , "ğŸ‡¸ğŸ‡ª" ] , [ "æ–°åŠ å¡" , "ğŸ‡¸ğŸ‡¬" ] , [ "æ³°å›½" , "ğŸ‡¹ğŸ‡­" ] , [ "çªå°¼è¥¿äºš" , "ğŸ‡¹ğŸ‡³" ] , [ "æ±¤åŠ " , "ğŸ‡¹ğŸ‡´" ] , [ "åœŸè€³å…¶" , "ğŸ‡¹ğŸ‡·" ] , [ "å›¾ç“¦å¢" , "ğŸ‡¹ğŸ‡»" ] , [ "å°æ¹¾" , "ğŸ‡¨ğŸ‡³" ] , [ "è‹±å›½" , "ğŸ‡¬ğŸ‡§" ] , [ "ç¾å±ç¦»å²›" , "ğŸ‡ºğŸ‡²" ] , [ "ç¾å›½" , "ğŸ‡ºğŸ‡¸" ] , [ "ä¹Œæ‹‰åœ­" , "ğŸ‡ºğŸ‡¾" ] , [ "ä¹Œå…¹åˆ«å…‹" , "ğŸ‡ºğŸ‡¿" ] , [ "æ¢µè’‚å†ˆ" , "ğŸ‡»ğŸ‡¦" ] , [ "å§”å†…ç‘æ‹‰" , "ğŸ‡»ğŸ‡ª" ] , [ "è‹±å±ç»´äº¬ç¾¤å²›" , "ğŸ‡»ğŸ‡¬" ] , [ "ç¾å±ç»´äº¬ç¾¤å²›" , "ğŸ‡»ğŸ‡®" ] , [ "è¶Šå—" , "ğŸ‡»ğŸ‡³" ] , [ "å—é" , "ğŸ‡¿ğŸ‡¦"]])

var body = $response.body;
var obj = JSON.parse(body);
var title = flags.get(obj['countryCode']) + ' '+obj['country'];
var subtitle = default_regionName + default_org;

var index = obj['org'].indexOf('(');
if (index != -1) {
    subtitle = RegionName_Check(obj['regionName']) + ' â  ' + Org_Check(obj['org'].substring(0, index).trim());
} else {
    subtitle = RegionName_Check(obj['regionName']) + ' â  ' + Org_Check(obj['org']);
}

var ip = obj['query'];

var description = "å›½å®¶" + ":" + obj['country'] + '\n'+'åœ°åŒº:' + (obj['regionName']) + '\n' + "åŸå¸‚" + ":" + (obj['city']) + '\n' + "è¿è¥å•†" + ":" + (obj['isp']) + '\n' + "æ•°æ®ä¸­å¿ƒ" + ":" + (obj['org']) + '\n' + "IP" + ":" + obj['query'] + '\n' + "æ—¶åŒº" + ":" + obj['timezone'] + '\n' + "ç»åº¦" + ":" + obj['lon'] + '\n' + "çº¬åº¦" + ":" + obj['lat'];

$done({title, subtitle, ip, description});
